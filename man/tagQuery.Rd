% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tag_env.R
\name{tagQuery}
\alias{tagQuery}
\title{Tag graph}
\usage{
tagQuery(tags)
}
\arguments{
\item{tags}{Any standard tag object or \code{tagList()}. If a \code{list()} or \code{tagList()} is provided, a \code{tagList()} will be returned when calling \verb{$asTags()}.}
}
\value{
A \code{tagQuery()} object. The \code{tag} supplied will be considered the \code{root} object. At the time of initialization, the \code{root} is also considered the single selected item. If any selections are made, the selected elements will be updated.
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}
}
\details{
This function is VERY experimental. The result api will most likely change. \strong{Use at your own risk.}

\code{tagQuery()} is modeled after \href{jquery.com}{\code{jQuery}}'s \href{https://api.jquery.com/category/manipulation/}{DOM maninipulation methods} and \href{https://api.jquery.com/category/traversing/tree-traversal/}{Tree Traversal} categories with some alterations. One of the main differences is that there is no centralized \code{window.document} object to use or reference. Instead, only the original tags provided to \code{tagQuery(tags=)} are fully search-able.

\code{tagQuery()} is built to perform complex alterations within a set of tags. For example, it is difficult to find a set of tags and alter the parent tag when working with standard \code{\link{tag}} objects. With \code{tagQuery()}, it is possible to find all \verb{<span>} tags that match the css selector \verb{div .inner span}, then ask for the grandparent tag objects, then add a class to these grandparent tag elements.  This could be accomplished using code similar to\if{html}{\out{<div class="r">}}\preformatted{tagQuery(ex_tags)$find("div .inner span")$parent()$parent()$add_class("custom-class")$as_tags(selected = FALSE)
}\if{html}{\out{</div>}}

This style of alteration is not easily achieved when using typical "pass by value" R objects or standard tag objects.
}
\section{Tag graph components}{
\subsection{Tag environments}{

"Tag environments" are the building blocks to \code{tagQuery()}. When creating a \code{tagQuery()}, each tag object is converted to a tag environment. This conversion allows for element alterations to happen in place (pass by reference). Meaning that if a css class is added to each selected tag environment using \verb{$addClass()} and the result of the method call is ignored, the selected tag environments in the tag graph will still contain the class addition.  The added class will exist when the tag graph is converted back to standard tags objects with \verb{$asTags()}.

Tag environments also contain an extra field, \code{.$parent}. The \code{.$parent} value contains their parent tag environment. The top level tags supplied to \code{tagQuery()} will also have a shared parent element. (The shared parent element will have a \code{NULL} \code{.$parent} value.) This allows for performing sibling alterations at the top level of the graph.

The set of tag environments in a pointing to each other within a tag graph can be thought of as a linked list while allowing for a "1 to many" parent to child relationship and up to 1 parent per child.
}

\subsection{Tag graphs}{

A \code{tagQuery()} behaves simliar to an R6 object (but a tag graph is not implemented with \code{R6}). The \code{tagQuery()}'s methods will return itself as much as possible, unless the method is directly asking for information, e.g. \verb{$selected()} or \verb{$asTags()}.

Internally, two important pieces of information are maintained: the root element and the selected elements. The root tag environment will always point (after upgrading to a tag environment) to the original tag object provided to \code{tagQuery(tag=)}. However, the selected elements are a list of tag environments that update for every \verb{$find(cssSelector)} call.  The selected elements are initialized to a list containing the \code{root} tag environment. All \code{tagQuery()} methods will act on the selected elements unless declared otherwise.
}
}

\section{Methods}{
All methods return the altered tag graph object unless otherwise stated.
\subsection{Select tags}{
\itemize{
\item \verb{$find(cssSelector)}: Find all tag elements matching the \code{cssSelector} starting from each selected element. The selected elements will be updated with the found set of tag environment.
\item \verb{$fitler(fn)}: Update the selected elements to a subset of the selected elements given \code{fn(el, i)} returns \code{TRUE}. If \code{fn} is a CSS selector, then the selected elements will be filtered if they match the single selector value.
\item \verb{$children()}: Update the selected elements to contain all direct child elements of the selected elements.
\item \verb{$parent()}: Update the selected elements to contain the unique set of direct parent of the selected elements.
\item \verb{$parents()}: Update the selected elements to contain the unique set of all ancestors of the selected elements.
\item \code{siblings()}: Get the siblings of each element in the set of matched elements.
\item \verb{$reset()}: Resets the selected elements to the root.
}
}

\subsection{Update selected tag info}{
\itemize{
\item \verb{$addClass(class)}: Apps class(es) to each of the the selected elements.
\item \verb{$removeClass(class)}: Removes a set of class values from all of the selected elements.
\item \verb{$hasClass(class)}: Determine whether the selected elements have a given class. Returns a vector of logical values.
\item \verb{$toggleClass(class)}: If the a class value is missing, add it. If a  class value already exists, remove it.
\item \verb{$addAttrs(...)}: Add named attributes to all selected children. Similar to \code{\link[=tagAppendAttributes]{tagAppendAttributes()}}.
\item \verb{$removeAttrs(attrs)}: Removes the provided attributes in each of the selected elements.
\item \verb{$emptyAttrs()}: Removes all attributes in each of the selected elements.
\item \verb{$hasAttr(attr)}: Returns a vector whose values are whether the selected element contains the non-\code{NULL} attribute.
}
}

\subsection{Adjust child elements}{
\itemize{
\item \verb{$append(...)}: Add all \code{...} objects as children \strong{after} any existing children to the selected elements. Similar to \code{\link[=tagAppendChildren]{tagAppendChildren()}}
\item \verb{$prepend(...)}: Add all \code{...} objects as children \strong{before} any existing children to the selected elements. A variation of \code{\link[=tagAppendChildren]{tagAppendChildren()}}
\item \verb{$empty(...)}: Remove all children in the selected elements. Use this method before calling \verb{$append(...)} to replace all selected elements' children.
}
}

\subsection{Generic methods}{
\itemize{
\item \verb{$each(fn)}: Perform function \code{fn} on each of the selected elements. \code{fn} should accept two arguments: a selected element and the selected element's position within the selected elements. This argument order is different than jQuery's \verb{$().each()} as there is no concept of a \code{this} object inside the function execution. To stay consistent with other methods, the each of the selected tag environments will be given first, followed by the index position. Any alterations to the provided tag environments will persist in calling tag graph.
}
}

\subsection{Tag Graph functions}{
\itemize{
\item \verb{$rebuild()}: Makes sure that all tags have been upgraded to tag environments. Objects wrapped in \code{HTML()} will not be inspected or altered. This method is internally called before each method executes and after any alterations where standard tag objects could be introduced into the tag structure.
\item \verb{$graph()}: Return all top level tags environments. If there are more than one, it will be returned within a \code{tagList()}. If there is only one tag, it will be returned.
\item \verb{$selected()}: Returns a list of selected tag environments.
\item \verb{$get(position)}: Returns the selected tag element at the position \code{position}.
}
}

\subsection{Convert to tags}{
\itemize{
\item \verb{$asTags(selected = TRUE)}: If \code{selected = TRUE}, then all previously found elements (and their descendants) will be converted to tags. If \code{selected = FALSE}, the top level tag elements (and their descendants) will be converted to standard tags. If there is more than one element being returned, a \code{tagList()} will be used to hold all of the objects.
Internal methods
\item \verb{$print()}: Prints the tag graph. Called by \code{print.htmltools.tagQuery()}
}
}
}

\section{Limitations}{


\code{tagQuery()}s can \strong{not} be used directly within typical \code{tag} locations. An error should be thrown. Instead, please call \verb{$asTags()} to retrieve the tag structures of the selected tag elements or root element respectively.
}

